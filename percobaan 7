import tkinter as tk
from tkinter import ttk, messagebox
from datetime import datetime
import matplotlib.pyplot as plt
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg

# Model
class Transaksi:
    def __init__(self, tanggal, jenis, kategori, jumlah, deskripsi):
        self.tanggal = datetime.strptime(tanggal, '%Y-%m-%d')
        self.jenis = jenis
        self.kategori = kategori
        self.jumlah = jumlah
        self.deskripsi = deskripsi

class Anggaran:
    def __init__(self, kategori, jumlah, periode):
        self.kategori = kategori
        self.jumlah = jumlah
        self.periode = periode
        self.status = "Belum Tercapai"

# Controller
class Keuangan:
    def __init__(self):
        self.transaksi_list = []
        self.anggaran_list = []

    def tambah_transaksi(self, transaksi):
        self.transaksi_list.append(transaksi)

    def hapus_transaksi(self, index):
        del self.transaksi_list[index]

    def tambah_anggaran(self, anggaran):
        self.anggaran_list.append(anggaran)

    def total_pemasukan(self):
        return sum(t.jumlah for t in self.transaksi_list if t.jenis == 'Pemasukan')

    def total_pengeluaran(self):
        return sum(t.jumlah for t in self.transaksi_list if t.jenis == 'Pengeluaran')

# View
class KeuanganGUI:
    def __init__(self, root):
        self.keuangan = Keuangan()
        self.root = root
        self.root.title("Sistem Pencatatan Keuangan Pribadi")

        self.bahasa = tk.StringVar(value="Indonesia")
        self.tema = tk.StringVar(value="Terang")

        self.texts = {
            "Indonesia": {
                "title": "Sistem Pencatatan Keuangan Pribadi",
                "dashboard": "Dashboard",
                "transaksi": "Transaksi",
                "anggaran": "Anggaran",
                "laporan": "Laporan",
                "pengaturan": "Pengaturan",
                "tanggal": "Tanggal (YYYY-MM-DD)",
                "jenis": "Jenis",
                "kategori": "Kategori",
                "jumlah": "Jumlah",
                "deskripsi": "Deskripsi",
                "simpan": "Simpan",
                "pengaturan_anggaran": "Pengaturan Anggaran",
                "periode": "Periode",
                "total_pemasukan": "Total Pemasukan: Rp {0:,.2f}",
                "total_pengeluaran": "Total Pengeluaran: Rp {0:,.2f}",
                "laporan_grafik": "Laporan dan Grafik",
                "pilih_periode": "Pilih Periode: ",
                "pilih_kategori_grafik": "Pilih Kategori Grafik: ",
                "tampilkan": "Tampilkan",
                "pengaturan_pengguna": "Pengaturan Pengguna",
                "pilih_bahasa": "Pilih Bahasa",
                "pilih_tema": "Pilih Tema",
                "transaksi_berhasil": "Transaksi berhasil disimpan",
                "anggaran_berhasil": "Anggaran berhasil disimpan",
                "data_tidak_valid": "Data tidak valid: {0}"
            },
            "Inggris": {
                "title": "Personal Finance Recording System",
                "dashboard": "Dashboard",
                "transaksi": "Transactions",
                "anggaran": "Budget",
                "laporan": "Reports",
                "pengaturan": "Settings",
                "tanggal": "Date (YYYY-MM-DD)",
                "jenis": "Type",
                "kategori": "Category",
                "jumlah": "Amount",
                "deskripsi": "Description",
                "simpan": "Save",
                "pengaturan_anggaran": "Budget Settings",
                "periode": "Period",
                "total_pemasukan": "Total Income: Rp {0:,.2f}",
                "total_pengeluaran": "Total Expense: Rp {0:,.2f}",
                "laporan_grafik": "Reports and Charts",
                "pilih_periode": "Select Period: ",
                "pilih_kategori_grafik": "Select Chart Category: ",
                "tampilkan": "Show",
                "pengaturan_pengguna": "User Settings",
                "pilih_bahasa": "Select Language",
                "pilih_tema": "Select Theme",
                "transaksi_berhasil": "Transaction saved successfully",
                "anggaran_berhasil": "Budget saved successfully",
                "data_tidak_valid": "Invalid data: {0}"
            }
        }
        self.create_widgets()
        self.update_text()  # Panggil fungsi update_text pada saat inisialisasi

        def update_text(self):
        # Update teks pada setiap widget berdasarkan bahasa yang dipilih
            self.title_label.config(text=self.texts[self.bahasa.get()]["title"])
            self.btn_dashboard.config(text=self.texts[self.bahasa.get()]["dashboard"])
            self.btn_transaksi.config(text=self.texts[self.bahasa.get()]["transaksi"])
            self.btn_anggaran.config(text=self.texts[self.bahasa.get()]["anggaran"])
            self.btn_laporan.config(text=self.texts[self.bahasa.get()]["laporan"])
            self.btn_pengaturan.config(text=self.texts[self.bahasa.get()]["pengaturan"])

        # Tambahan kode untuk memperbarui teks pada label-label dan tombol-tombol lainnya
            self.entry_tanggal_label.config(text=self.texts[self.bahasa.get()]["tanggal"])
            self.entry_jenis_label.config(text=self.texts[self.bahasa.get()]["jenis"])
    # ... dan seterusnya untuk label-label lainnya

    # Perbarui teks pada tombol-tombol
            self.save_button.config(text=self.texts[self.bahasa.get()]["simpan"])
            
    def create_widgets(self):
        # Header
        header = tk.Frame(self.root, bg='blue', pady=10)
        header.pack(fill=tk.X)
        self.title_label = tk.Label(header, text=self.texts[self.bahasa.get()]["title"], bg='blue', fg='white', font=('Arial', 16))
        self.title_label.pack()

        # Menu
        menu = tk.Frame(self.root, bg='lightgray', pady=10)
        menu.pack(fill=tk.X)
        self.btn_dashboard = tk.Button(menu, text=self.texts[self.bahasa.get()]["dashboard"], command=self.show_dashboard)
        self.btn_transaksi = tk.Button(menu, text=self.texts[self.bahasa.get()]["transaksi"], command=self.show_transaksi)
        self.btn_anggaran = tk.Button(menu, text=self.texts[self.bahasa.get()]["anggaran"], command=self.show_anggaran)
        self.btn_laporan = tk.Button(menu, text=self.texts[self.bahasa.get()]["laporan"], command=self.show_laporan)
        self.btn_pengaturan = tk.Button(menu, text=self.texts[self.bahasa.get()]["pengaturan"], command=self.show_pengaturan)

        self.btn_dashboard.pack(side=tk.LEFT, padx=10)
        self.btn_transaksi.pack(side=tk.LEFT, padx=10)
        self.btn_anggaran.pack(side=tk.LEFT, padx=10)
        self.btn_laporan.pack(side=tk.LEFT, padx=10)
        self.btn_pengaturan.pack(side=tk.LEFT, padx=10)

        # Main Frame
        self.main_frame = tk.Frame(self.root)
        self.main_frame.pack(fill=tk.BOTH, expand=True)
        self.show_dashboard()

    def show_dashboard(self):
        self.clear_frame()
        tk.Label(self.main_frame, text=self.texts[self.bahasa.get()]["dashboard"], font=('Arial', 14)).pack()
        tk.Label(self.main_frame, text=self.texts[self.bahasa.get()]["total_pemasukan"].format(self.keuangan.total_pemasukan())).pack()
        tk.Label(self.main_frame, text=self.texts[self.bahasa.get()]["total_pengeluaran"].format(self.keuangan.total_pengeluaran())).pack()
        
    def show_transaksi(self):
        self.clear_frame()
        tk.Label(self.main_frame, text="Pencatatan Transaksi", font=('Arial', 14)).pack()

        form = tk.Frame(self.main_frame)
        form.pack(pady=10)

        tk.Label(form, text="Tanggal (YYYY-MM-DD)").grid(row=0, column=0, padx=5, pady=5)
        tk.Label(form, text="Jenis").grid(row=1, column=0, padx=5, pady=5)
        tk.Label(form, text="Kategori").grid(row=2, column=0, padx=5, pady=5)
        tk.Label(form, text="Jumlah").grid(row=3, column=0, padx=5, pady=5)
        tk.Label(form, text="Deskripsi").grid(row=4, column=0, padx=5, pady=5)

        self.entry_tanggal = tk.Entry(form)
        self.entry_jenis = ttk.Combobox(form, values=["Pemasukan", "Pengeluaran"])
        self.entry_kategori = ttk.Combobox(form, values=[])
        self.entry_jumlah = tk.Entry(form)
        self.entry_deskripsi = tk.Entry(form)

        self.entry_tanggal.grid(row=0, column=1, padx=5, pady=5)
        self.entry_jenis.grid(row=1, column=1, padx=5, pady=5)
        self.entry_kategori.grid(row=2, column=1, padx=5, pady=5)
        self.entry_jumlah.grid(row=3, column=1, padx=5, pady=5)
        self.entry_deskripsi.grid(row=4, column=1, padx=5, pady=5)

        self.entry_jenis.bind("<<ComboboxSelected>>", self.update_kategori)

        tk.Button(form, text="Simpan", command=self.simpan_transaksi).grid(row=5, column=1, pady=10)

        self.tabel_transaksi = ttk.Treeview(self.main_frame, columns=("Tanggal", "Jenis", "Kategori", "Jumlah", "Deskripsi"), show="headings")
        self.tabel_transaksi.heading("Tanggal", text="Tanggal")
        self.tabel_transaksi.heading("Jenis", text="Jenis")
        self.tabel_transaksi.heading("Kategori", text="Kategori")
        self.tabel_transaksi.heading("Jumlah", text="Jumlah")
        self.tabel_transaksi.heading("Deskripsi", text="Deskripsi")
        self.tabel_transaksi.pack(fill=tk.BOTH, expand=True)

        self.load_transaksi()

    def update_kategori(self, event):
        jenis = self.entry_jenis.get()
        if jenis == "Pemasukan":
            self.entry_kategori['values'] = ["Gaji", "Bonus", "Investasi", "Deposito", "Dividen", "Hibah", "Investasi", "Kupon", "Penjualan", "Penyewaan", "Tabungan", "Lainnya"]
        elif jenis == "Pengeluaran":
            self.entry_kategori['values'] = ["Makanan", "Transportasi", "Hiburan", "Asuransi", "Pakaian", "Pulsa", "Rokok", "Tagihan", "Elektronik", "Sosial", "Pendidikan", "Kantor", "Kecantikan", "Kesehatan", "Mobil", "Motor", "Lainnya"]

    def simpan_transaksi(self):
        try:
            tanggal = self.entry_tanggal.get()
            jenis = self.entry_jenis.get()
            kategori = self.entry_kategori.get()
            jumlah = float(self.entry_jumlah.get())
            deskripsi = self.entry_deskripsi.get()

            if not tanggal or not jenis or not kategori or not deskripsi:
                raise ValueError("Semua field harus diisi")

            if jenis == "Pengeluaran":
                jumlah = -jumlah

            transaksi = Transaksi(tanggal, jenis, kategori, jumlah, deskripsi)
            self.keuangan.tambah_transaksi(transaksi)
            messagebox.showinfo("Informasi", "Transaksi berhasil disimpan")
            self.load_transaksi()
        except ValueError as e:
            messagebox.showerror("Error", f"Data tidak valid: {e}")

    def load_transaksi(self):
        for item in self.tabel_transaksi.get_children():
            self.tabel_transaksi.delete(item)
        for transaksi in self.keuangan.transaksi_list:
            self.tabel_transaksi.insert("", "end", values=(transaksi.tanggal.strftime('%Y-%m-%d'), transaksi.jenis, transaksi.kategori, transaksi.jumlah, transaksi.deskripsi))

    def show_anggaran(self):
        self.clear_frame()
        tk.Label(self.main_frame, text="Pengaturan Anggaran", font=('Arial', 14)).pack()

        form = tk.Frame(self.main_frame)
        form.pack(pady=10)

        tk.Label(form, text="Kategori").grid(row=0, column=0, padx=5, pady=5)
        tk.Label(form, text="Jumlah").grid(row=1, column=0, padx=5, pady=5)
        tk.Label(form, text="Periode").grid(row=2, column=0, padx=5, pady=5)

        self.entry_kategori_anggaran = ttk.Combobox(form, values=["Makanan", "Transportasi", "Hiburan", "Lainnya"])
        self.entry_jumlah_anggaran = tk.Entry(form)
        self.entry_periode_anggaran = ttk.Combobox(form, values=["Mingguan", "Bulanan", "Tahunan"])

        self.entry_kategori_anggaran.grid(row=0, column=1, padx=5, pady=5)
        self.entry_jumlah_anggaran.grid(row=1, column=1, padx=5, pady=5)
        self.entry_periode_anggaran.grid(row=2, column=1, padx=5, pady=5)

        tk.Button(form, text="Simpan", command=self.simpan_anggaran).grid(row=3, column=1, pady=10)

        self.tabel_anggaran = ttk.Treeview(self.main_frame, columns=("Kategori", "Jumlah", "Periode", "Status"), show="headings")
        self.tabel_anggaran.heading("Kategori", text="Kategori")
        self.tabel_anggaran.heading("Jumlah", text="Jumlah")
        self.tabel_anggaran.heading("Periode", text="Periode")
        self.tabel_anggaran.heading("Status", text="Status")
        self.tabel_anggaran.pack(fill=tk.BOTH, expand=True)

        self.load_anggaran()

    def simpan_anggaran(self):
        try:
            kategori = self.entry_kategori_anggaran.get()
            jumlah = float(self.entry_jumlah_anggaran.get())
            periode = self.entry_periode_anggaran.get()

            if not kategori or not jumlah or not periode:
                raise ValueError("Semua field harus diisi")

            anggaran = Anggaran(kategori, jumlah, periode)
            self.keuangan.tambah_anggaran(anggaran)
            messagebox.showinfo("Informasi", "Anggaran berhasil disimpan")
            self.load_anggaran()
        except ValueError as e:
            messagebox.showerror("Error", f"Data tidak valid: {e}")

    def load_anggaran(self):
        for item in self.tabel_anggaran.get_children():
            self.tabel_anggaran.delete(item)
        for anggaran in self.keuangan.anggaran_list:
            self.tabel_anggaran.insert("", "end", values=(anggaran.kategori, anggaran.jumlah, anggaran.periode, anggaran.status))

    def show_laporan(self):
        self.clear_frame()
        tk.Label(self.main_frame, text="Laporan dan Grafik", font=('Arial', 14)).pack()

        periode_frame = tk.Frame(self.main_frame)
        periode_frame.pack(pady=10)

        tk.Label(periode_frame, text="Pilih Periode: ").pack(side=tk.LEFT, padx=5)
        self.combo_periode = ttk.Combobox(periode_frame, values=["Mingguan", "Bulanan", "Tahunan"])
        self.combo_periode.pack(side=tk.LEFT, padx=5)
        tk.Button(periode_frame, text="Tampilkan", command=self.tampilkan_grafik).pack(side=tk.LEFT, padx=5)

        self.grafik_frame = tk.Frame(self.main_frame)
        self.grafik_frame.pack(fill=tk.BOTH, expand=True)

    def tampilkan_grafik(self):
        for widget in self.grafik_frame.winfo_children():
            widget.destroy()

        periode = self.combo_periode.get()
        if periode:
            pengeluaran_per_kategori = {}
            for transaksi in self.keuangan.transaksi_list:
                if transaksi.jenis == 'Pengeluaran':
                    if transaksi.kategori not in pengeluaran_per_kategori:
                        pengeluaran_per_kategori[transaksi.kategori] = 0
                    pengeluaran_per_kategori[transaksi.kategori] += -transaksi.jumlah

            kategori = list(pengeluaran_per_kategori.keys())
            jumlah = list(pengeluaran_per_kategori.values())

            fig, ax = plt.subplots()
            ax.bar(kategori, jumlah)
            ax.set_xlabel('Kategori')
            ax.set_ylabel('Jumlah Pengeluaran')
            ax.set_title(f'Grafik Pengeluaran ({periode})')

            canvas = FigureCanvasTkAgg(fig, master=self.grafik_frame)
            canvas.draw()
            canvas.get_tk_widget().pack(fill=tk.BOTH, expand=True)

    def show_pengaturan(self):
        self.clear_frame()
        tk.Label(self.main_frame, text=self.texts[self.bahasa.get()]["pengaturan_pengguna"], font=('Arial', 14)).pack()

        form = tk.Frame(self.main_frame)
        form.pack(pady=10)

        tk.Label(form, text=self.texts[self.bahasa.get()]["pilih_bahasa"]).grid(row=0, column=0, padx=5, pady=5)
        bahasa_combobox = ttk.Combobox(form, textvariable=self.bahasa, values=["Indonesia", "Inggris"], state="readonly")
        bahasa_combobox.grid(row=0, column=1, padx=5, pady=5)

        tk.Label(form, text=self.texts[self.bahasa.get()]["pilih_tema"]).grid(row=1, column=0, padx=5, pady=5)
        tema_combobox = ttk.Combobox(form, textvariable=self.tema, values=["Terang", "Gelap"], state="readonly")
        tema_combobox.grid(row=1, column=1, padx=5, pady=5)

        tk.Button(form, text=self.texts[self.bahasa.get()]["simpan"], command=self.simpan_pengaturan).grid(row=2, column=1, pady=10)

    def simpan_pengaturan(self):
        bahasa = self.bahasa.get()
        tema = self.tema.get()

        self.title_label.config(text=self.texts[bahasa]["title"])
        self.btn_dashboard.config(text=self.texts[bahasa]["dashboard"])
        self.btn_transaksi.config(text=self.texts[bahasa]["transaksi"])
        self.btn_anggaran.config(text=self.texts[bahasa]["anggaran"])
        self.btn_laporan.config(text=self.texts[bahasa]["laporan"])
        self.btn_pengaturan.config(text=self.texts[bahasa]["pengaturan"])

        if tema == "Terang":
            self.root.config(bg="white")
            self.main_frame.config(bg="white")
        elif tema == "Gelap":
            self.root.config(bg="gray20")
            self.main_frame.config(bg="gray20")

    def clear_frame(self):
        for widget in self.main_frame.winfo_children():
            widget.destroy()

if __name__ == "__main__":
    root = tk.Tk()
    app = KeuanganGUI(root)
    app.update_text()  # Panggil update_text() setelah inisialisasi objek
    root.mainloop()

